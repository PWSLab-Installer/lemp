- hosts: localhost
  connection: local
  vars:
    php_version: '7.2'
    php_default_version_debian: '7.2'
  # Roles are imported from ansible

  tasks:
      
    - name: Install Role NGINX
      local_action: command ansible-galaxy install -f geerlingguy.nginx 

    - name: Install Role MYSQL
      local_action: command ansible-galaxy install -f geerlingguy.mysql

    - name: Install Role PHP
      local_action: command ansible-galaxy install -f geerlingguy.php

    - name: Check the version of CentOS
      shell: |
        cat: /etc/centos-release
      register: cent_os
      ignore_errors: yes

    - name: Check the version of Ubuntu
      shell: |
        lsb_release -d
      register: ubuntu_os
      ignore_errors: yes

    - name: Applying replacement on CentOS
      lineinfile:
          dest: ~/.ansible/roles/geerlingguy.php/vars/Debian.yml
          regexp: '^__php_webserver_daemon: '
          line: '__php_webserver_daemon: "nginx"'
          state: present
      when:
        - cent_os.stdout | regex_search("CentOS")
    
    - name: Applying replacement on Ubuntu
      lineinfile:
          dest: ~/.ansible/roles/geerlingguy.php/vars/Debian.yml
          regexp: '^__php_webserver_daemon: '
          line: '__php_webserver_daemon: "nginx"'
          state: present
      when:
        - ubuntu_os.stdout | regex_search("Ubuntu")

    - name: Installing NGINX
      include_role:
        name: geerlingguy.nginx
    
    - name: Installing MYSQL
      include_role:
          name: geerlingguy.mysql

    - name: Installing PHP
      include_role:
          name: geerlingguy.php
